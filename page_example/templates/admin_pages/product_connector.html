
{% extends "admin_pages/product_base.html" %}
{% load static %}
{% block page-title %}
    <title>连接器</title>
    <meta name="keywords" content="连接器">
    <meta name="description" content="连接器录入">
{% endblock %}

{% block product-private %}

    <div style="width: 100%" class="container ui-sortable">
        <div id="tab_demo" class="HuiTab">
            <div class="tabBar clearfix"><span>添加产品</span><span onclick="freshRecords()">查看管理</span></div>
            <div class="tabCon">
                <div class="panel panel-default">
                    <div class="panel-header">连接器</div>
                    <br>
                    <div class="radio-box">
                        <input type="radio" id="radio_cable" name="type-radio" value="for_cable" onclick="ljqTypeChange(this)" checked>
                        <label for="radio-2">适配电缆</label>
                    </div>
                    <div class="radio-box">
                        <input type="radio" id="radio_pcb" name="type-radio" value="for_pcb" onclick="ljqTypeChange(this)">
                        <label for="radio-disabled">适配PCB</label>
                    </div>
                    <div class="panel-body">
                        <form id="connector_cable_form" name="connector_cable_form" method="post"
                              enctype="multipart/form-data"
                              action="">
                            {% csrf_token %}
                            {% include 'admin_pages/connector_cable_form_tbl.html' %}}
                            <input id="add_connector_cable" class="btn btn-primary radius mt-10" type="submit" value="添加产品" >
                        </form>

                        <form id="connector_pcb_form" name="uploadForm" method="post"
                              enctype="multipart/form-data"
                              action="" style="display: none">
                            {% csrf_token %}
                            {% include 'admin_pages/connector_pcb_form_tbl.html' %}
                            <input id="add_connector" class="btn btn-primary radius mt-10" type="submit" value="添加产品" >
                        </form>
                    </div>
                </div>
                <br>
                <div class="panel panel-default">
                    <div id='result' class="panel-header">添加结果</div>
                    <table class="table table-border table-bordered table-striped">
                        <thead>
                        <tr>
                            <th width="5%">序号</th>
                            <th width="10%">WITC编号</th>
                            <th width="10%">类型</th>
                            <th width="10%">极性</th>
                            <th width="10%">外形</th>
                            <th width="10%">图片</th>
                            <th width="10%">规格书</th>
                            <th width="10%">操作</th>

                        </tr>
                        </thead>
                        <tbody id="result_display">
                        {% include 'admin_pages/connector_recent_table.html' %}
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="tabCon">
                <div class="panel panel-default">
                    <div class="panel-header">连接器查询条件</div>
                    <div class="panel-body">
                        <table id="ljqShipeidianlan" class="table table-border table-bordered table-bg">
                            <thead>
                            <tr>
                                <th>类型</th>
                                <th>极性</th>
                                <th>用途</th>
                                <th>安装类型</th>
                                <th>外形</th>
                                <th>电缆型号</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td><span class="select-box size-MINI">
                                <select  nullmsg="系列" datatype="*" name="" size="1"
                                         class="select">
                                     <option value ="">空</option>
                                    {% for obj in category %}
                                        <option value ="{{ forloop.counter }}">{{ obj.content }}</option>
                                    {% endfor %}
                                </select>
                            </span></td>
                                <td><span class="select-box size-MINI">
                                <select nullmsg="极性" datatype="*" name="" size="1" class="select">
                                    <option value ="">空</option>
                                    {% for obj in polar %}
                                        <option value ="{{ forloop.counter }}">{{ obj.content }}</option>
                                    {% endfor %}
                                </select>
                            </span></td>
                                <td><span class="select-box size-MINI">
                                <select  nullmsg="用途" datatype="*" name="" size="1" class="select"
                                         onchange="ljqTypeChange(this)">
                                     <option value ="">空</option>
                                    <option value="1">适配电缆</option>
                                    <option value="2">面板安装</option>
                                    </select>
                            </span></td>
                                <td><span class="select-box size-MINI">
                                <select nullmsg="" datatype="*" name="" size="1" class="select">
                                     <option value ="">空</option>
                                    {% for obj in install_type %}
                                        <option value ="{{ forloop.counter }}">{{ obj.content }}</option>
                                    {% endfor %}
                                </select>
                            </span></td>
                                <td><span class="select-box size-MINI">
                                <select nullmsg="" datatype="*" name="" size="1" class="select">
                                     <option value ="">空</option>
                                    {% for obj in out_look %}
                                        <option value ="{{ forloop.counter }}">{{ obj.content }}</option>
                                    {% endfor %}
                                 </select>
                                    </select>
                            </span></td>
                                <td><span class="select-box size-MINI">
                                <select id="matchedCable" nullmsg="" datatype="*" name="" size="1" class="select">
                                     <option value ="">空</option>
                                    <option value="1">无</option>
                                    <option value="2">直option>
                                </select>
                            </span></td>
                            </tr>

                            </tbody>
                        </table>

                        <input id="admin_start_query" class="btn btn-primary radius mt-10" type="button" value="查询" >
                    </div>
                </div>

                <div class="panel panel-default">
                    <div id='admin_result' class="panel-header">产品列表</div>
                    <table class="table table-border table-bordered table-striped">
                        <thead>
                        <tr>
                            <th width="10%">序号</th>
                            <th width="10">缩略图</th>
                            <th width="10%">产品概况</th>
                            <th width="20%">产品属性</th>
                            <th width="20%">WITC编号，规格书</th>
                            <th width="20%">操作</th>
                        </tr>
                        </thead>
                        <tbody id="filter_results">
                        {% include 'admin_pages/connector_table.html' %}
                        </tbody>
                    </table>
                </div>

            </div>

        </div>
    </div>

    <div id="modal-demo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content radius">
                <div class="modal-header">
                    <h3 class="modal-title">注意</h3>
                    <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                </div>
                <div class="modal-body">
                    <p>确认删除产品</p>
                    <p id="delete_witc"></p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="do_delete()" aria-hidden="true">确定</button>
                    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modify_connector_cable" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content radius">
                <div class="modal-header">
                    <h3 class="modal-title">修改产品</h3>
                    <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                </div>
                <div class="modal-body">
                    <form id="modify_connector_cable_form" name="modify_connector_cable_form" method="post"
                          enctype="multipart/form-data"
                          action="">
                        {% csrf_token %}
                        <div id="replace_part_cable">
                        {% include 'admin_pages/connector_cable_form_tbl.html' %}
                            </div>
                        <input id="modify_add_connector_cable" class="btn btn-primary radius mt-10" type="submit" value="修改产品" >
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="do_modify_cable()" aria-hidden="true">确定</button>
                    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modify_connector_pcb" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content radius">
                <div class="modal-header">
                    <h3 class="modal-title" >修改产品</h3>
                    <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                </div>
                <div class="modal-body">
                    <form id="modify_connector_pcb_form" name="uploadForm" method="post"
                          enctype="multipart/form-data"
                          action="">
                        {% csrf_token %}
                        <h5 id="modify_pcb_witc"></h5>
                        <div id="replace_part_pcb">

                        {% include 'admin_pages/connector_pcb_form_tbl.html' %}
                            </div>
                        <input id="modify_add_connector" class="btn btn-primary radius mt-10" type="submit" value="修改产品" >
                    </form>
                </div>
                <div class="modal-footer">
                    <!--<button class="btn btn-primary" onclick="do_modify_pcb()" aria-hidden="true">确定</button>-->
                    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block private-script %}
    <script>
        $("#tab_demo").Huitab({
            index:0
        });

        function goto_modify(obj){
            var row = obj.parentNode.parentNode;
            var td = $(row).find("td");
            var witc = td.eq(0).text();
            var data = {witc: witc};
            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });

            $.ajax({
                type:"POST",
                url: "{% url 'admin_filter_connector' %}",
                data: data,
                cache:false,
                success: function(data) {
                    if(data == -1 ){
                        alert("该记录已经存在");
                    }
                    document.getElementById("modify_pcb_witc").innerHTML=witc
                    $('#replace_part_pcb').html(data);
                    $("#modify_connector_pcb").modal("show");

                },
                error: function() {
                    $('.loginError').html('请求失败，请刷新页面后重试').show();
                }
            });
            return false;

        }

        function goto_delete(obj){
            var row = obj.parentNode.parentNode;
            var td = $(row).find("td");
            var witc = td.eq(4).text();
            document.getElementById("delete_witc").innerHTML=witc;
            $("#modal-demo").modal("show");
        }

        function do_delete(){
            var witc = document.getElementById("delete_witc").innerHTML;
            $("#modal-demo").modal("hide");
        }

        function do_modify_pcb(){
            var loss_ratio = document.getElementById("lossratio").value
            alert(loss_ratio)
            $("#modify_connector_pcb").modal("hide");
        }

        function do_modify_cable(){
            var loss_ratio = document.getElementById("m_connector_cable_lossratio").value;
            alert(loss_ratio)
            $("#modify_connector_cable").modal("hide");
        }

        function ljqTypeChange(obj){
            var currObj = obj;
            if(currObj.id == "radio_cable") {
                document.getElementById("connector_cable_form").style.display = "";
                document.getElementById("connector_pcb_form").style.display="none"
            }else{
                document.getElementById("connector_cable_form").style.display = "none";
                document.getElementById("connector_pcb_form").style.display=""
            }

        }

        $(document).ready(function(){
            $('#nav-product').addClass("current")
            $('#start-query').click(function(){
                alert('query');
                $.get("{% url 'notify' %}", function(data){
                    alert("get " + data.result);
                });
            });
        });

        $('#connector_pcb_form').submit(function(){
            var formData = new FormData(document.getElementById("connector_pcb_form"));
            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });

            $.ajax({
                type:"POST",
                url: "{% url 'admin_add_connector' %}",
                data: formData,
                cache:false,
                contentType: false,
                processData: false,
                success: function(data) {
                    if(data == -1 ){
                        alert("该记录已经存在");
                    }
                    $('#result_display').html(data);
                },
                error: function() {
                    $('.loginError').html('请求失败，请刷新页面后重试').show();
                }
            });
            return false;
        });

        $('#modify_connector_pcb_form').submit(function(){
            var formData = new FormData(document.getElementById("modify_connector_pcb_form"));
            var raw_witc = document.getElementById("modify_pcb_witc").innerHTML;
            formData.append('raw_witc', raw_witc);
            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });

            $.ajax({
                type:"POST",
                url: "{% url 'admin_modify_connector_pcb' %}",
                data: formData,
                cache:false,
                contentType: false,
                processData: false,
                success: function(data) {
                    if(data == -1 ){
                        alert("该记录已经存在");
                        return;
                    }
                    $("#modify_connector_pcb").modal("hide");
                    freshRecords();

                },
                error: function() {
                    $('.loginError').html('请求失败，请刷新页面后重试').show();
                }
            });
            return false;
        });


        function freshRecords(){

            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });

            $.ajax({
                type:"POST",
                url: "{% url 'admin_filter_connector' %}",
                data: {},
                cache:false,
                contentType: false,
                processData: false,
                success: function(data) {
                    if(data == -1 ){
                        alert("该记录已经存在");
                    }
                    $('#filter_results').html(data);

                },
                error: function() {
                    $('.loginError').html('请求失败，请刷新页面后重试').show();
                }
            });
            return false;

        }

        $('#admin_start_query').click(function(){
            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });
            var con = {'a': 'b'};
            $.ajax({
                type:"POST",
                url: "{% url 'admin_filter_connector' %}",
                data: con,
                cache:false,
                success: function(data) {
                    if(data == -1 ){
                        alert("该记录已经存在");
                    }
                    $('#filter_results').html(data);
                },
                error: function() {
                    $('.loginError').html('请求失败，请刷新页面后重试').show();
                    alter("err")
                }
            });
            return false;
        });

        {#        $('#add_connector').click(function(){#}
        {#            var type = $("input[name='type-radio']:checked()").val();#}
        {##}
        {#            if ("for_cable" == type){#}
        {#                var category = $('#connector_cable_type option:selected').text();#}
        {#                var polar = $('#connector_cable_polar option:selected').text();#}
        {#                var install_type = $('connector_cable_install option:selected').text();#}
        {##}
        {#                var reg = /^\d+(\.\d+)?$/;#}
        {#                var loss_ratio = $('#connector_cable_lossratio').val();#}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("差损系数：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {##}
        {#                var inner_diam = $('#connector_cable_inner_diameter').val();#}
        {##}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("电缆内导体直径：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {#                var outer_diam = $('#connector_cable_outer_diameter').val();#}
        {##}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("电缆外导体直径：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {##}
        {##}
        {#                var matched_cable = $('#matched_cable_type').val();#}
        {#                var upper_freq = $('#connector_cable_upper_freq').val();#}
        {##}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("截止频率：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {##}
        {#                var out_look = $('#connector_cable_outlook option:selected').text();#}
        {#                var property = $('#connector_cable_property option:selected').text();#}
        {#                var combo_type = $('#connector_cable_combo_type option:selected').text();#}
        {#                if("" == combo_type ){#}
        {#                    alert("请选择特性");#}
        {#                    return;#}
        {#                }#}
        {##}
        {#                var witc_code = $('#connector_cable_witc_no').text();#}
        {#                var witc_code_in_combo = $('#connector_cable_combo_witc_no').text();#}
        {##}
        {#                var data_context = {#}
        {#                    category: category,#}
        {#                    polar: polar,#}
        {#                    install_type: install_type,#}
        {#                    loss_ratio: loss_ratio,#}
        {#                    inner_dim: inner_diam,#}
        {#                    outer_dim: outer_diam,#}
        {#                    matched_cable: matched_cable,#}
        {#                    upper_freq: upper_freq,#}
        {#                    out_look: out_look,#}
        {#                    property: property,#}
        {#                    combo_type: combo_type,#}
        {#                    witc_code: witc_code,#}
        {#                    witc_code_in_combo: witc_code_in_combo#}
        {#                };#}
        {##}
        {#            }#}
        {#            else{#}
        {#                var category = $('#connector_pcb_type option:selected').text();#}
        {#                var polar = $('#connector_pcb_polar option:selected').text();#}
        {#                var install_type = $('#connector_pcb_install option:selected').text();#}
        {#                var stand_wave = $('#connector_pcb_stand_wave').val();#}
        {##}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("驻波：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {##}
        {#                var upper_freq = $('#connector_pcb_upper_freq').val();#}
        {##}
        {#                if (reg.test(loss_ratio) == false){#}
        {#                    alert("截止频率：请输入正确数字");#}
        {#                    return;#}
        {#                }#}
        {#                var out_look = $('#connector_pcb_outlook option:selected').text();#}
        {#                var property = $('#connector_pcb_property option:selected').text();#}
        {#                var witc_code = $('#connector_pcb_witc_no').val();#}
        {#                var witc_code_in_combo = $('#connector_pcb_combo_witc').val();#}
        {##}
        {##}
        {#                var data_context = {#}
        {#                    category: category,#}
        {#                    polar: polar,#}
        {#                    install_type: install_type,#}
        {#                    stand_wave: stand_wave,#}
        {#                    upper_freq: upper_freq,#}
        {#                    out_look: out_look,#}
        {#                    property: property,#}
        {#                    combo_type: combo_type,#}
        {#                    witc_code: witc_code,#}
        {#                    witc_code_in_combo: witc_code_in_combo#}
        {#                };#}
        {#            }#}
        {#            if("空" == category){#}
        {#                alert("请选择类型");#}
        {#                return;#}
        {#            }#}
        {#            if("空" == polar){#}
        {#                alert("请选择极性");#}
        {#                return;#}
        {#            }#}
        {#            if("空" == out_look){#}
        {#                alert("请选择外形");#}
        {#                return;#}
        {#            }#}
        {##}
        {#            if("空" == property){#}
        {#                alert("请选择特性");#}
        {#                return;#}
        {#            }#}
        {##}
        {#            $.ajaxSetup({#}
        {#                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },#}
        {#            });#}
        {##}
        {#            $.ajax({#}
        {#                type:"POST",#}
        {#                url: "{% url 'admin_add_connector' %}",#}
        {#                data: data_context,#}
        {#                dataType:'json',#}
        {#                cache:false,#}
        {#                success: function(data) {#}
        {#                    if(data == 1 ){#}
        {#                        alert("insert");#}
        {#                        window.location.href="{% url 'admin_others_out_look' %}";#}
        {#                    }#}
        {#                    if(data == -1 ){#}
        {#                        alert("该记录已经存在");#}
        {#                    }#}
        {#                },#}
        {#                error: function() {#}
        {#                    $('.loginError').html('请求失败，请刷新页面后重试').show();#}
        {#                }#}
        {#            });#}
        {##}
        {#        });#}

    </script>
{% endblock %}
